@using VidsNet.Models;
@using VidsNet.DataModels;
@using VidsNet.Enums;
@using VidsNet.Classes;
@using Microsoft.AspNetCore.Mvc.Routing;
@using Microsoft.AspNetCore.Html;
@using System.IO;
@model VidsNet.ViewModels.HomeViewModel
@{
    var items = (List<BaseVirtualItem>)@Model.VirtualItems;
    int parentItemCount = items.AsQueryable().Where(x => x.IsDeleted).Count();
}

@functions {   
    string PrintListing(List<BaseVirtualItem> items, List<RealItem> realItems) {
        var ret = new TagBuilder("div");
        int padding = 10;
        List<BaseVirtualItem> it = items.Where(x => x.IsDeleted).OrderBy(x => x.Type).ThenBy(y => y.Name).ToList();
        var isLast = true;
        foreach(var item in it){            
            if(item.Type == Item.Folder) {
                ret.InnerHtml.AppendHtml(HtmlHelpers.GenerateViewFolder(item, padding, items.Where(x => x.ParentId == item.Id).Count(), isLast, View.Deleted, 0));
            }
            else {
                var urlContext = new UrlRouteContext() { RouteName = "ItemView"};
                if(VidsNet.Constants.IsSqlite) {
                    var realItem = realItems.Where(x => x.Id == item.RealItemId).First();
                    urlContext.Values = new {id = item.Id, session = Model.SessionHash, name = (item.Name + realItem.Extension)};
                }
                else {
                    var tmp = (VirtualItem)item;
                    urlContext.Values = new {id = tmp.Id, session = Model.SessionHash, name = (tmp.Name + tmp.RealItem.Extension)};
                }

                ret.InnerHtml.AppendHtml(HtmlHelpers.GenerateViewItem(item, padding, Url.RouteUrl(urlContext), isLast, View.Deleted, 0));
            }
        }

        return HtmlHelpers.TagToString(ret);
    }
}
<div class="list-group">
    <div class="list-group-item" style="background: #D8D8D8">
        <div class="pull-left myPadding">
            <h5 aria-hidden="true" class="glyphicon-folder-close glyphicon" id="0_name"></h5>
            <span class="pull-s-right label-pill label-default label countPadding" id="parentCount">@parentItemCount</span>
        </div>
        <div class="pull-left listingPadding">
            <span class="pull-xs-left">
                <select id="listingType" name="listingType" class="form-control " onchange="changeVirtualView();">
                    <option value="0">Default</option>
                    <option value="1">Viewed</option>
                    <option value="2" selected="selected">Deleted</option>
                </select>
            </span>
        </div>
        <div class="clearfix"></div>
    </div>
    @if(@Model.VirtualItems.Count > 0) {
        @Html.Raw(@PrintListing(@Model.VirtualItems, @Model.RealItems))
    }
    else {
        <div class="panel-body">
            <div class="alert alert-info">No items.</div>
        </div>
    }
</div>